var jsfeat=jsfeat||{REVISION:"ALPHA"};self.Int32Array=self.Int32Array||Array,self.Uint32Array=self.Uint32Array||Array,self.Uint8Array=self.Uint8Array||Array,self.Float32Array=self.Float32Array||Array,self.Float64Array=self.Float64Array||Array,function(t){var e=1.192092896e-7,a=1e-37,r=256,f=512,i=1024,o=2048,n=4096,s=1,h=2,u=3,c=4,d=new Int32Array([-1,1,4,-1,4,-1,-1,-1,8,-1,-1,-1,-1,-1,-1,-1,8]),l=function(){return function(t){return 65280&t}}(),_=function(){return function(t){return 255&t}}(),v=function(){return function(t){return d[(65280&t)>>8]}}(),p=1,b=1,g=2,w=function(){function t(t,e){this.size=(t+7|0)&-8,"undefined"==typeof e?this.buffer=new ArrayBuffer(this.size):(this.buffer=e,this.size=e.length),this.u8=new Uint8Array(this.buffer),this.i32=new Int32Array(this.buffer),this.f32=new Float32Array(this.buffer),this.f64=new Float64Array(this.buffer)}return t}(),y=function(){function t(t,e,a,o){this.type=0|l(a),this.channel=0|_(a),this.cols=0|t,this.rows=0|e,"undefined"==typeof o?this.buffer=new w(t*v(a)*_(a)*e):this.buffer=o,this.data=this.type&r?this.buffer.u8:this.type&f?this.buffer.i32:this.type&i?this.buffer.f32:this.buffer.f64}return t.prototype.set_data_type=function(t){this.type=0|l(t),this.channel=0|_(t),delete this.data,delete this.buffer,this.buffer=new w(this.cols*v(t)*_(t)*this.rows),this.data=this.type&r?this.buffer.u8:this.type&f?this.buffer.i32:this.type&i?this.buffer.f32:this.buffer.f64},t.prototype.set_data=function(t){for(var e=t.length;--e>=0;)this.data[e]=t[e]},t}(),m=function(){function t(t){this.levels=0|t,this.data=new Array(t),this.pyrdown=jsfeat.imgproc.pyrdown}return t.prototype.allocate=function(t,e,a){for(var r=this.levels;--r>=0;)this.data[r]=new y(t>>r,e>>r,a)},t.prototype.build=function(t,e){"undefined"==typeof e&&(e=!0);var a=2,r=t,f=this.data[0];if(!e)for(var i=t.cols*t.rows;--i>=0;)f.data[i]=t.data[i];for(f=this.data[1],this.pyrdown(r,f);a<this.levels;++a)r=f,f=this.data[a],this.pyrdown(r,f)},t}(),j=function(){function t(t,e,a,r){"undefined"==typeof t&&(t=0),"undefined"==typeof e&&(e=0),"undefined"==typeof a&&(a=0),"undefined"==typeof r&&(r=0),this.x=t,this.y=e,this.score=a,this.level=r}return t}();t.U8_t=r,t.S32_t=f,t.F32_t=i,t.S64_t=o,t.F64_t=n,t.C1_t=s,t.C2_t=h,t.C3_t=u,t.C4_t=c,t.EPSILON=e,t.FLT_MIN=a,t.BOX_BLUR_NOSCALE=p,t.SVD_U_T=b,t.SVD_V_T=g,t.get_data_type=l,t.get_channel=_,t.get_data_type_size=v,t.data_t=w,t.matrix_t=y,t.pyramid_t=m,t.point2d_t=j}(jsfeat),function(t){var e=function(){var t,e,a=function(){function t(t){this.next=null,this.data=new jsfeat.data_t(t),this.size=this.data.size,this.buffer=this.data.buffer,this.u8=this.data.u8,this.i32=this.data.i32,this.f32=this.data.f32,this.f64=this.data.f64}return t.prototype.resize=function(t){delete this.data,this.data=new jsfeat.data_t(t),this.size=this.data.size,this.buffer=this.data.buffer,this.u8=this.data.u8,this.i32=this.data.i32,this.f32=this.data.f32,this.f64=this.data.f64},t}(),r=0;return{allocate:function(f,i){t=e=new a(i);for(var o=0;o<f;++o){var n=new a(i);e=e.next=n,r++}},get_buffer:function(e){var a=t;return t=t.next,r--,e>a.size&&a.resize(e),a},put_buffer:function(t){e=e.next=t,r++}}}();t.cache=e,e.allocate(30,2560)}(jsfeat),function(t){var e=function(){var t=new Int32Array(96);return{get_gaussian_kernel:function(t,e,a,r){var f=0,i=0,o=0,n=0,s=0,h=0,u=jsfeat.cache.get_buffer(t<<2),c=u.f32;if(1==(1&t)&&t<=7&&e<=0)switch(t>>1){case 0:c[0]=1,h=1;break;case 1:c[0]=.25,c[1]=.5,c[2]=.25,h=1;break;case 2:c[0]=.0625,c[1]=.25,c[2]=.375,c[3]=.25,c[4]=.0625,h=1;break;case 3:c[0]=.03125,c[1]=.109375,c[2]=.21875,c[3]=.28125,c[4]=.21875,c[5]=.109375,c[6]=.03125,h=1}else for(n=e>0?e:.3*(.5*(t-1)-1)+.8,s=-.5/(n*n);f<t;++f)i=f-.5*(t-1),o=Math.exp(s*i*i),c[f]=o,h+=o;if(r&jsfeat.U8_t)for(h=256/h,f=0;f<t;++f)a[f]=c[f]*h+.5|0;else for(h=1/h,f=0;f<t;++f)a[f]=c[f]*h;jsfeat.cache.put_buffer(u)},qsort:function(e,a,r,f){var i,o,n,s,h=7,u=0,c=0,d=0,l=0,_=0,v=0,p=0,b=0,g=0,w=0,y=0,m=0,j=0,M=0,x=0,k=0,A=0,z=0,I=t;if(!(r-a+1<=1))for(I[0]=a,I[1]=r;u>=0;)for(c=I[u<<1],d=I[(u<<1)+1],u--;;){if(_=d-c+1,_<=h){for(p=c+1;p<=d;p++)for(b=p;b>c&&f(e[b],e[b-1]);b--)i=e[b],e[b]=e[b-1],e[b-1]=i;break}for(z=0,w=c,m=d,M=c+(_>>1),_>40&&(g=_>>3,x=c,k=c+g,A=c+(g<<1),o=e[x],n=e[k],s=e[A],c=f(o,n)?f(n,s)?k:f(o,s)?A:x:f(s,n)?k:f(o,s)?x:A,x=M-g,k=M,A=M+g,o=e[x],n=e[k],s=e[A],M=f(o,n)?f(n,s)?k:f(o,s)?A:x:f(s,n)?k:f(o,s)?x:A,x=d-(g<<1),k=d-g,A=d,o=e[x],n=e[k],s=e[A],d=f(o,n)?f(n,s)?k:f(o,s)?A:x:f(s,n)?k:f(o,s)?x:A),x=c,k=M,A=d,o=e[x],n=e[k],s=e[A],M=f(o,n)?f(n,s)?k:f(o,s)?A:x:f(s,n)?k:f(o,s)?x:A,M!=w&&(i=e[M],e[M]=e[w],e[w]=i,M=w),c=y=w+1,d=j=m,o=e[M];;){for(;c<=d&&!f(o,e[c]);)f(e[c],o)||(c>y&&(i=e[y],e[y]=e[c],e[c]=i),z=1,y++),c++;for(;c<=d&&!f(e[d],o);)f(o,e[d])||(d<j&&(i=e[j],e[j]=e[d],e[d]=i),z=1,j--),d--;if(c>d)break;i=e[c],e[c]=e[d],e[d]=i,z=1,c++,d--}if(0==z){for(c=w,d=m,p=c+1;p<=d;p++)for(b=p;b>c&&f(e[b],e[b-1]);b--)i=e[b],e[b]=e[b-1],e[b-1]=i;break}for(_=Math.min(y-w,c-y),v=c-_|0,l=0;l<_;++l,++v)i=e[w+l],e[w+l]=e[v],e[v]=i;for(_=Math.min(m-j,j-d),v=m-_+1|0,l=0;l<_;++l,++v)i=e[c+l],e[c+l]=e[v],e[v]=i;if(_=c-y,v=j-d,_>1)v>1?_>v?(++u,I[u<<1]=w,I[(u<<1)+1]=w+_-1,c=m-v+1,d=m):(++u,I[u<<1]=m-v+1,I[(u<<1)+1]=m,c=w,d=w+_-1):(c=w,d=w+_-1);else{if(!(v>1))break;c=m-v+1,d=m}}},median:function(t,e,a){for(var r,f=0,i=0,o=0,n=e+a>>1;;){if(a<=e)return t[n];if(a==e+1)return t[e]>t[a]&&(r=t[e],t[e]=t[a],t[a]=r),t[n];for(f=e+a>>1,t[f]>t[a]&&(r=t[f],t[f]=t[a],t[a]=r),t[e]>t[a]&&(r=t[e],t[e]=t[a],t[a]=r),t[f]>t[e]&&(r=t[f],t[f]=t[e],t[e]=r),i=e+1,r=t[f],t[f]=t[i],t[i]=r,o=a;;){do++i;while(t[e]>t[i]);do--o;while(t[o]>t[e]);if(o<i)break;r=t[i],t[i]=t[o],t[o]=r}r=t[e],t[e]=t[o],t[o]=r,o<=n?e=i:o>=n&&(a=o-1)}return 0}}}();t.math=e}(jsfeat),function(t){var e=function(){return{transpose:function(t,e){for(var a=0,r=0,f=e.rows,i=e.cols,o=0,n=0,s=0,h=e.data,u=t.data;a<f;n+=1,o+=i,a++)for(s=n,r=0;r<i;s+=f,r++)u[s]=h[o+r]},multiply:function(t,e,a){for(var r=0,f=0,i=0,o=0,n=0,s=0,h=0,u=0,c=e.cols,d=e.rows,l=a.cols,_=e.data,v=a.data,p=t.data,b=0;r<d;o+=c,r++)for(h=0,f=0;f<l;u++,h++,f++){for(s=h,n=o,b=0,i=0;i<c;n++,s+=l,i++)b+=_[n]*v[s];p[u]=b}},multiply_ABt:function(t,e,a){for(var r=0,f=0,i=0,o=0,n=0,s=0,h=0,u=e.cols,c=e.rows,d=a.rows,l=e.data,_=a.data,v=t.data,p=0;r<c;o+=u,r++)for(s=0,f=0;f<d;h++,f++){for(n=o,p=0,i=0;i<u;n++,s++,i++)p+=l[n]*_[s];v[h]=p}},multiply_AtB:function(t,e,a){for(var r=0,f=0,i=0,o=0,n=0,s=0,h=0,u=0,c=e.cols,d=e.rows,l=a.cols,_=e.data,v=a.data,p=t.data,b=0;r<c;o++,r++)for(h=0,f=0;f<l;u++,h++,f++){for(s=h,n=o,b=0,i=0;i<d;n+=c,s+=l,i++)b+=_[n]*v[s];p[u]=b}},multiply_AAt:function(t,e){for(var a=0,r=0,f=0,i=0,o=0,n=0,s=0,h=0,u=0,c=e.cols,d=e.rows,l=e.data,_=t.data,v=0;a<d;i+=d+1,o=n,a++)for(h=i,u=i,s=o,r=a;r<d;h++,u+=d,r++){for(n=o,v=0,f=0;f<c;f++)v+=l[n++]*l[s++];_[h]=v,_[u]=v}},multiply_AtA:function(t,e){for(var a=0,r=0,f=0,i=0,o=0,n=0,s=0,h=0,u=0,c=e.cols,d=e.rows,l=e.data,_=t.data,v=0;a<c;s+=c,a++)for(i=a,u=s+a,h=u,r=a;r<c;h++,u+=c,r++){for(o=i,n=r,v=0,f=0;f<d;o+=c,n+=c,f++)v+=l[o]*l[n];_[h]=v,_[u]=v}}}}();t.matmath=e}(jsfeat),function(t){var e=function(){var t=function(t,e,a,r){r=t[e],t[e]=t[a],t[a]=r},e=function(t,e){return t=Math.abs(t),e=Math.abs(e),t>e?(e/=t,t*Math.sqrt(1+e*e)):e>0?(t/=e,e*Math.sqrt(1+t*t)):0},a=function(a,r,f,i,o,n){var s=jsfeat.EPSILON,h=0,u=0,c=0,d=0,l=0,_=0,v=0,p=0,b=0,g=n*n*30,w=0,y=0,m=0,j=0,M=0,x=0,k=0,A=0,z=0,I=jsfeat.cache.get_buffer(n<<2),q=jsfeat.cache.get_buffer(n<<2),S=I.i32,U=q.i32;if(i)for(;h<n;h++){for(c=h*o,u=0;u<n;u++)i[c+u]=0;i[c+h]=1}for(c=0;c<n;c++){if(f[c]=a[(r+1)*c],c<n-1){for(d=c+1,w=Math.abs(a[r*c+d]),h=c+2;h<n;h++)y=Math.abs(a[r*c+h]),w<y&&(w=y,d=h);S[c]=d}if(c>0){for(d=0,w=Math.abs(a[c]),h=1;h<c;h++)y=Math.abs(a[r*h+c]),w<y&&(w=y,d=h);U[c]=d}}if(n>1)for(;b<g;b++){for(c=0,w=Math.abs(a[S[0]]),h=1;h<n-1;h++)y=Math.abs(a[r*h+S[h]]),w<y&&(w=y,c=h);for(l=S[c],h=1;h<n;h++)y=Math.abs(a[r*U[h]+h]),w<y&&(w=y,c=U[h],l=h);if(m=a[r*c+l],Math.abs(m)<=s)break;for(j=.5*(f[l]-f[c]),M=Math.abs(j)+e(m,j),x=e(m,M),k=M/x,x=m/x,M=m/M*m,j<0&&(x=-x,M=-M),a[r*c+l]=0,f[c]-=M,f[l]+=M,h=0;h<c;h++)v=r*h+c,p=r*h+l,A=a[v],z=a[p],a[v]=A*k-z*x,a[p]=A*x+z*k;for(h=c+1;h<l;h++)v=r*c+h,p=r*h+l,A=a[v],z=a[p],a[v]=A*k-z*x,a[p]=A*x+z*k;for(h=l+1,v=r*c+h,p=r*l+h;h<n;h++,v++,p++)A=a[v],z=a[p],a[v]=A*k-z*x,a[p]=A*x+z*k;if(i)for(v=o*c,p=o*l,h=0;h<n;h++,v++,p++)A=i[v],z=i[p],i[v]=A*k-z*x,i[p]=A*x+z*k;for(u=0;u<2;u++){if(_=0==u?c:l,_<n-1){for(d=_+1,w=Math.abs(a[r*_+d]),h=_+2;h<n;h++)y=Math.abs(a[r*_+h]),w<y&&(w=y,d=h);S[_]=d}if(_>0){for(d=0,w=Math.abs(a[_]),h=1;h<_;h++)y=Math.abs(a[r*h+_]),w<y&&(w=y,d=h);U[_]=d}}}for(c=0;c<n-1;c++){for(d=c,h=c+1;h<n;h++)f[d]<f[h]&&(d=h);if(c!=d&&(t(f,d,c,w),i))for(h=0;h<n;h++)t(i,o*d+h,o*c+h,w)}jsfeat.cache.put_buffer(I),jsfeat.cache.put_buffer(q)},r=function(a,r,f,i,o,n,s,h){for(var u=10*jsfeat.EPSILON,c=jsfeat.FLT_MIN,d=0,l=0,_=0,v=0,p=Math.max(n,30),b=0,g=0,w=0,y=0,m=0,j=0,M=0,x=0,k=0,A=0,z=0,I=0,q=0,S=0,U=0,C=0,D=0,L=4660,V=0,N=0,O=0,E=jsfeat.cache.get_buffer(s<<3),F=E.f64;d<s;d++){for(_=0,z=0;_<n;_++)x=a[d*r+_],z+=x*x;if(F[d]=z,i){for(_=0;_<s;_++)i[d*o+_]=0;i[d*o+d]=1}}for(;v<p;v++){for(m=0,d=0;d<s-1;d++)for(l=d+1;l<s;l++){for(b=d*r|0,g=l*r|0,U=F[d],C=0,D=F[l],_=3,C+=a[b]*a[g],C+=a[b+1]*a[g+1],C+=a[b+2]*a[g+2];_<n;_++)C+=a[b+_]*a[g+_];if(!(Math.abs(C)<=u*Math.sqrt(U*D))){if(C*=2,I=U-D,q=e(C,I),I<0?(S=.5*(q-I),M=Math.sqrt(S/q),j=C/(q*M*2)):(j=Math.sqrt((q+I)/(2*q)),M=C/(q*j*2),S=C*C*.5/(q+I)),F[d]+=S,F[l]-=S,1&v&&F[d]>0&&F[l]>0)for(_=3,k=j*a[b]+M*a[g],A=-M*a[b]+j*a[g],a[b]=k,a[g]=A,k=j*a[b+1]+M*a[g+1],A=-M*a[b+1]+j*a[g+1],a[b+1]=k,a[g+1]=A,k=j*a[b+2]+M*a[g+2],A=-M*a[b+2]+j*a[g+2],a[b+2]=k,a[g+2]=A;_<n;_++)k=j*a[b+_]+M*a[g+_],A=-M*a[b+_]+j*a[g+_],a[b+_]=k,a[g+_]=A;else{for(U=D=0,_=3,k=j*a[b]+M*a[g],A=-M*a[b]+j*a[g],a[b]=k,a[g]=A,U+=k*k,D+=A*A,k=j*a[b+1]+M*a[g+1],A=-M*a[b+1]+j*a[g+1],a[b+1]=k,a[g+1]=A,U+=k*k,D+=A*A,k=j*a[b+2]+M*a[g+2],A=-M*a[b+2]+j*a[g+2],a[b+2]=k,a[g+2]=A,U+=k*k,D+=A*A;_<n;_++)k=j*a[b+_]+M*a[g+_],A=-M*a[b+_]+j*a[g+_],a[b+_]=k,a[g+_]=A,U+=k*k,D+=A*A;F[d]=U,F[l]=D}if(m=1,i)for(w=d*o|0,y=l*o|0,_=3,k=j*i[w]+M*i[y],A=-M*i[w]+j*i[y],i[w]=k,i[y]=A,k=j*i[w+1]+M*i[y+1],A=-M*i[w+1]+j*i[y+1],i[w+1]=k,i[y+1]=A,k=j*i[w+2]+M*i[y+2],A=-M*i[w+2]+j*i[y+2],i[w+2]=k,i[y+2]=A;_<s;_++)k=j*i[w+_]+M*i[y+_],A=-M*i[w+_]+j*i[y+_],i[w+_]=k,i[y+_]=A}}if(0==m)break}for(d=0;d<s;d++){for(_=0,z=0;_<n;_++)x=a[d*r+_],z+=x*x;F[d]=Math.sqrt(z)}for(d=0;d<s-1;d++){for(l=d,_=d+1;_<s;_++)F[l]<F[_]&&(l=_);if(d!=l&&(t(F,d,l,z),i)){for(_=0;_<n;_++)t(a,d*r+_,l*r+_,x);for(_=0;_<s;_++)t(i,d*o+_,l*o+_,x)}}for(d=0;d<s;d++)f[d]=F[d];if(!i)return void jsfeat.cache.put_buffer(E);for(d=0;d<h;d++){for(z=d<s?F[d]:0;z<=c;){for(N=1/n,_=0;_<n;_++)L=214013*L+2531011,V=0!=(L>>16&32767&256)?N:-N,a[d*r+_]=V;for(v=0;v<2;v++)for(l=0;l<d;l++){for(z=0,_=0;_<n;_++)z+=a[d*r+_]*a[l*r+_];for(O=0,_=0;_<n;_++)x=a[d*r+_]-z*a[l*r+_],a[d*r+_]=x,O+=Math.abs(x);for(O=O?1/O:0,_=0;_<n;_++)a[d*r+_]*=O}for(z=0,_=0;_<n;_++)x=a[d*r+_],z+=x*x;z=Math.sqrt(z)}for(M=1/z,_=0;_<n;_++)a[d*r+_]*=M}jsfeat.cache.put_buffer(E)};return{lu_solve:function(e,a){var r,f,i,o,n=0,s=0,h=0,u=1,c=e.cols,d=e.data,l=a.data;for(n=0;n<c;n++){for(h=n,s=n+1;s<c;s++)Math.abs(d[s*c+n])>Math.abs(d[h*c+n])&&(h=s);if(Math.abs(d[h*c+n])<jsfeat.EPSILON)return 0;if(h!=n){for(s=n;s<c;s++)t(d,n*c+s,h*c+s,r);t(l,n,h,r),u=-u}for(i=-1/d[n*c+n],s=n+1;s<c;s++){for(f=d[s*c+n]*i,h=n+1;h<c;h++)d[s*c+h]+=f*d[n*c+h];l[s]+=f*l[n]}d[n*c+n]=-i}for(n=c-1;n>=0;n--){for(o=l[n],h=n+1;h<c;h++)o-=d[n*c+h]*l[h];l[n]=o*d[n*c+n]}return 1},cholesky_solve:function(t,e){var a,r,f=0,i=0,o=0,n=0,s=0,h=0,u=0,c=t.cols,d=t.data,l=e.data;for(f=0;f<c;f++)for(r=1,n=f*c,s=n,i=f;i<c;i++){for(a=d[s+f],o=0;o<f;o++)a-=d[o*c+f]*d[s+o];if(i==f){if(d[s+f]=a,0==a)return 0;r=1/a}else d[n+i]=a,d[s+f]=a*r;s+=c}for(n=0,h=0;h<c;h++){for(a=l[h],u=0;u<h;u++)a-=d[n+u]*l[u];l[h]=a,n+=c}for(n=0,h=0;h<c;h++)l[h]/=d[n+h],n+=c;for(h=c-1;h>=0;h--){for(a=l[h],u=h+1,n=u*c;u<c;u++)a-=d[n+h]*l[u],n+=c;l[h]=a}return 1},svd_decompose:function(t,e,a,f,i){"undefined"==typeof i&&(i=0);var o=0,n=0,s=t.rows,h=t.cols,u=s,c=h,d=t.type|jsfeat.C1_t;u<c&&(o=1,n=u,u=c,c=n);var l=jsfeat.cache.get_buffer(u*u<<3),_=jsfeat.cache.get_buffer(c<<3),v=jsfeat.cache.get_buffer(c*c<<3),p=new jsfeat.matrix_t(u,u,d,l.data),b=new jsfeat.matrix_t(1,c,d,_.data),g=new jsfeat.matrix_t(c,c,d,v.data);if(0==o)jsfeat.matmath.transpose(p,t);else{for(n=0;n<h*s;n++)p.data[n]=t.data[n];for(;n<c*u;n++)p.data[n]=0}if(r(p.data,u,b.data,g.data,c,u,c,u),e){for(n=0;n<c;n++)e.data[n]=b.data[n];for(;n<h;n++)e.data[n]=0}if(0==o){if(a&&i&jsfeat.SVD_U_T)for(n=u*u;--n>=0;)a.data[n]=p.data[n];else a&&jsfeat.matmath.transpose(a,p);if(f&&i&jsfeat.SVD_V_T)for(n=c*c;--n>=0;)f.data[n]=g.data[n];else f&&jsfeat.matmath.transpose(f,g)}else{if(a&&i&jsfeat.SVD_U_T)for(n=c*c;--n>=0;)a.data[n]=g.data[n];else a&&jsfeat.matmath.transpose(a,g);if(f&&i&jsfeat.SVD_V_T)for(n=u*u;--n>=0;)f.data[n]=p.data[n];else f&&jsfeat.matmath.transpose(f,p)}jsfeat.cache.put_buffer(l),jsfeat.cache.put_buffer(_),jsfeat.cache.put_buffer(v)},svd_solve:function(t,e,a){var r=0,f=0,i=0,o=0,n=0,s=t.rows,h=t.cols,u=0,c=0,d=0,l=t.type|jsfeat.C1_t,_=jsfeat.cache.get_buffer(s*s<<3),v=jsfeat.cache.get_buffer(h<<3),p=jsfeat.cache.get_buffer(h*h<<3),b=new jsfeat.matrix_t(s,s,l,_.data),g=new jsfeat.matrix_t(1,h,l,v.data),w=new jsfeat.matrix_t(h,h,l,p.data),y=a.data,m=b.data,j=g.data,M=w.data;for(this.svd_decompose(t,g,b,w,0),d=jsfeat.EPSILON*j[0]*h;r<h;r++,n+=h){for(c=0,f=0;f<h;f++)if(j[f]>d){for(i=0,u=0,o=0;i<s;i++,o+=h)u+=m[o+f]*y[i];c+=u*M[n+f]/j[f]}e.data[r]=c}jsfeat.cache.put_buffer(_),jsfeat.cache.put_buffer(v),jsfeat.cache.put_buffer(p)},svd_invert:function(t,e){var a=0,r=0,f=0,i=0,o=0,n=0,s=e.rows,h=e.cols,u=0,c=0,d=e.type|jsfeat.C1_t,l=jsfeat.cache.get_buffer(s*s<<3),_=jsfeat.cache.get_buffer(h<<3),v=jsfeat.cache.get_buffer(h*h<<3),p=new jsfeat.matrix_t(s,s,d,l.data),b=new jsfeat.matrix_t(1,h,d,_.data),g=new jsfeat.matrix_t(h,h,d,v.data),w=t.data,y=p.data,m=b.data,j=g.data;for(this.svd_decompose(e,b,p,g,0),c=jsfeat.EPSILON*m[0]*h;a<h;a++,o+=h)for(r=0,i=0;r<s;r++,n++){for(f=0,u=0;f<h;f++,i++)m[f]>c&&(u+=j[o+f]*y[i]/m[f]);w[n]=u}jsfeat.cache.put_buffer(l),jsfeat.cache.put_buffer(_),jsfeat.cache.put_buffer(v)},eigenVV:function(t,e,r){for(var f=t.cols,i=f*f,o=t.type|jsfeat.C1_t,n=jsfeat.cache.get_buffer(f*f<<3),s=jsfeat.cache.get_buffer(f<<3),h=new jsfeat.matrix_t(f,f,o,n.data),u=new jsfeat.matrix_t(1,f,o,s.data);--i>=0;)h.data[i]=t.data[i];if(a(h.data,f,u.data,e?e.data:null,f,f),r)for(;--f>=0;)r.data[f]=u.data[f];jsfeat.cache.put_buffer(n),jsfeat.cache.put_buffer(s)}}}();t.linalg=e}(jsfeat),function(t){var e=function(){return{affine_3point_transform:function(t,e,a,r,f,i,o,n,s,h,u,c,d){},perspective_4point_transform:function(t,e,a,r,f,i,o,n,s,h,u,c,d,l,_,v,p){var b=e,g=h,w=o,y=b*g*w,m=_,j=b*m,M=g*j,x=u,k=b*x,A=i,z=a,I=l,q=z*I,S=q*A,U=I*A*x,C=I*w,D=I*x,L=g*w,V=m*g,N=m*A,O=x*A,E=1/(C-D-L+V-N+O),F=b*I,T=z*A,B=w*b,P=m*B,R=z*g,X=q*x,H=z*x*A,G=w*m*g,J=m*z,K=-(M-y+k*A-A*j-q*g+S-U+C*g)*E,Q=(y-M-F*w+F*x+S-g*T+N*g-U)*E,W=b,Y=(-x*j+P+R*w-q*w+X-H+N*x-G)*E,Z=(-P+B*x-J*g+X-H+J*A+G-C*x)*E,$=z,tt=(-k+B+R-T+D-C-V+N)*E,et=(-j+k+q-R+N-O-C+L)*E;b=r,g=c,w=s,y=b*g*w,m=p,j=b*m,M=g*j,x=d,k=b*x,A=n,z=f,I=v,q=z*I,S=q*A,U=I*A*x,C=I*w,D=I*x,L=g*w,V=m*g,N=m*A,O=x*A,E=1/(C-D-L+V-N+O),F=b*I,T=z*A,B=w*b,P=m*B,R=z*g,X=q*x,H=z*x*A,G=w*m*g,J=m*z;var at=-(M-y+k*A-A*j-q*g+S-U+C*g)*E,rt=(y-M-F*w+F*x+S-g*T+N*g-U)*E,ft=b,it=(-x*j+P+R*w-q*w+X-H+N*x-G)*E,ot=(-P+B*x-J*g+X-H+J*A+G-C*x)*E,nt=z,st=(-k+B+R-T+D-C-V+N)*E,ht=(-j+k+q-R+N-O-C+L)*E;g=Z-et*$,w=K*Z,y=K*$,j=Y*Q,M=W*Y,k=Q*tt;var ut=W*tt;I=1/(w-y*et-j+M*et+k*$-ut*Z),S=-Y+$*tt;var ct=-Y*et+Z*tt;O=-Q+W*et;var dt=K-ut;T=K*et-k,B=-Q*$+W*Z;var lt=y-M,_t=w-j;H=g*I;var vt=O*I,pt=B*I;t[0]=at*H+rt*(S*I)-ft*(ct*I),t[1]=at*vt+rt*(dt*I)-ft*(T*I),t[2]=-at*pt-rt*(lt*I)+ft*(_t*I),t[3]=it*H+ot*(S*I)-nt*(ct*I),t[4]=it*vt+ot*(dt*I)-nt*(T*I),t[5]=-it*pt-ot*(lt*I)+nt*(_t*I),t[6]=st*H+ht*(S*I)-ct*I,t[7]=st*vt+ht*(dt*I)-T*I,t[8]=-st*pt-ht*(lt*I)+_t*I},invert_affine_transform:function(t,e){var a=t[0],r=t[1],f=t[2],i=t[3],o=t[4],n=t[5],s=1/(a*o-r*i);e[0]=s*o,e[1]=s*-r,e[2]=s*(r*n-f*o),e[3]=s*-i,e[4]=s*a,e[5]=s*(f*i-a*n)},invert_perspective_transform:function(t,e){var a=t[0],r=t[1],f=t[2],i=t[3],o=t[4],n=t[5],s=t[6],h=t[7],u=t[8],c=1/(a*(o*u-n*h)-r*(i*u-n*s)+f*(i*h-o*s));e[0]=c*(o*u-n*h),e[1]=c*(f*h-r*u),e[2]=c*(r*n-f*o),e[3]=c*(n*s-i*u),e[4]=c*(a*u-f*s),e[5]=c*(f*i-a*n),e[6]=c*(i*h-o*s),e[7]=c*(r*s-a*h),e[8]=c*(a*o-r*i)}}}();t.transform=e}(jsfeat),function(t){var e=function(){var t=function(t,e,a,r){for(var f=[],i=0,o=t.channel,n=t.cols,s=t.rows,h=t.data,u=e.data,c=n/a,d=s/r,l=c*d*65536|0,_=0,v=0,p=0,b=0,g=0,w=0,y=0,m=0,j=0,M=0,x=0,k=0,A=0,z=0,I=0,q=0,S=jsfeat.cache.get_buffer(a*o<<2),U=jsfeat.cache.get_buffer(a*o<<2),C=S.i32,D=U.i32;_<a;_++){for(j=_*c,M=j+c,g=j+1-1e-6|0,w=0|M,g=Math.min(g,n-1),w=Math.min(w,n-1),g>j&&(f[i++]={si:(g-1)*o|0,di:_*o|0,alpha:256*(g-j)|0}),p=g;p<w;p++)f[i++]={si:p*o|0,di:_*o|0,alpha:256};M-w>.001&&(f[i++]={si:w*o|0,di:_*o|0,alpha:256*(M-w)|0})}for(_=0;_<a*o;_++)C[_]=D[_]=0;for(v=0,b=0;b<s;b++){for(x=n*b,m=0;m<i;m++)for(A=f[m].di,z=f[m].alpha,g=f[m].si,y=0;y<o;y++)C[A+y]+=h[x+g+y]*z;if((v+1)*d<=b+1||b==s-1){if(I=256*Math.max(b+1-(v+1)*d,0)|0,q=256-I,k=a*v,I<=0)for(_=0;_<a*o;_++)u[k+_]=Math.min(Math.max((D[_]+256*C[_])/l,0),255),D[_]=C[_]=0;else for(_=0;_<a*o;_++)u[k+_]=Math.min(Math.max((D[_]+C[_]*q)/l,0),255),D[_]=C[_]*I,C[_]=0;v++}else for(_=0;_<a*o;_++)D[_]+=256*C[_],C[_]=0}jsfeat.cache.put_buffer(U),jsfeat.cache.put_buffer(S)},e=function(t,e,a,r){for(var f=[],i=0,o=t.channel,n=t.cols,s=t.rows,h=t.data,u=e.data,c=n/a,d=s/r,l=1/(c*d),_=0,v=0,p=0,b=0,g=0,w=0,y=0,m=0,j=0,M=0,x=0,k=0,A=0,z=0,I=0,q=0,S=jsfeat.cache.get_buffer(a*o<<2),U=jsfeat.cache.get_buffer(a*o<<2),C=S.f32,D=U.f32;_<a;_++){for(j=_*c,M=j+c,g=j+1-1e-6|0,w=0|M,g=Math.min(g,n-1),w=Math.min(w,n-1),g>j&&(f[i++]={si:(g-1)*o|0,di:_*o|0,alpha:(g-j)*l}),p=g;p<w;p++)f[i++]={si:p*o|0,di:_*o|0,alpha:l};M-w>.001&&(f[i++]={si:w*o|0,di:_*o|0,alpha:(M-w)*l})}for(_=0;_<a*o;_++)C[_]=D[_]=0;for(v=0,b=0;b<s;b++){for(x=n*b,m=0;m<i;m++)for(A=f[m].di,z=f[m].alpha,g=f[m].si,y=0;y<o;y++)C[A+y]+=h[x+g+y]*z;if((v+1)*d<=b+1||b==s-1){if(I=Math.max(b+1-(v+1)*d,0),q=1-I,k=a*v,Math.abs(I)<.001)for(_=0;_<a*o;_++)u[k+_]=D[_]+C[_],D[_]=C[_]=0;else for(_=0;_<a*o;_++)u[k+_]=D[_]+C[_]*q,D[_]=C[_]*I,C[_]=0;v++}else for(_=0;_<a*o;_++)D[_]+=C[_],C[_]=0}jsfeat.cache.put_buffer(U),jsfeat.cache.put_buffer(S)},a=function(t,e,a,r,f,i,o,n){for(var s=0,h=0,u=0,c=0,d=0,l=0,_=0,v=0,p=0,b=i[0],g=0,w=r<<1,y=3*r,m=r<<2;s<f;++s){for(l=e[c],h=0;h<n;++h)t[h]=l;for(h=0;h<=r-2;h+=2)t[h+n]=e[c+h],t[h+n+1]=e[c+h+1];for(;h<r;++h)t[h+n]=e[c+h];for(l=e[c+r-1],h=r;h<n+r;++h)t[h+n]=l;for(h=0;h<=r-4;h+=4){for(l=t[h]*b,_=t[h+1]*b,v=t[h+2]*b,p=t[h+3]*b,u=1;u<o;++u)g=i[u],l+=t[u+h]*g,_+=t[u+h+1]*g,v+=t[u+h+2]*g,p+=t[u+h+3]*g;a[d+h]=l>>8,a[d+h+1]=_>>8,a[d+h+2]=v>>8,a[d+h+3]=p>>8}for(;h<r;++h){for(l=t[h]*b,u=1;u<o;++u)l+=t[u+h]*i[u];a[d+h]=l>>8}c+=r,d+=r}for(s=0;s<r;++s){for(l=a[s],h=0;h<n;++h)t[h]=l;for(u=s,h=0;h<=f-2;h+=2,u+=w)t[h+n]=a[u],t[h+n+1]=a[u+r];for(;h<f;++h,u+=r)t[h+n]=a[u];for(l=a[(f-1)*r+s],h=f;h<n+f;++h)t[h+n]=l;for(d=s,h=0;h<=f-4;h+=4,d+=m){for(l=t[h]*b,_=t[h+1]*b,v=t[h+2]*b,p=t[h+3]*b,u=1;u<o;++u)g=i[u],l+=t[u+h]*g,_+=t[u+h+1]*g,v+=t[u+h+2]*g,p+=t[u+h+3]*g;a[d]=l>>8,a[d+r]=_>>8,a[d+w]=v>>8,a[d+y]=p>>8}for(;h<f;++h,d+=r){for(l=t[h]*b,u=1;u<o;++u)l+=t[u+h]*i[u];a[d]=l>>8}}},r=function(t,e,a,r,f,i,o,n){for(var s=0,h=0,u=0,c=0,d=0,l=0,_=0,v=0,p=0,b=i[0],g=0,w=r<<1,y=3*r,m=r<<2;s<f;++s){for(l=e[c],h=0;h<n;++h)t[h]=l;for(h=0;h<=r-2;h+=2)t[h+n]=e[c+h],t[h+n+1]=e[c+h+1];for(;h<r;++h)t[h+n]=e[c+h];for(l=e[c+r-1],h=r;h<n+r;++h)t[h+n]=l;for(h=0;h<=r-4;h+=4){for(l=t[h]*b,_=t[h+1]*b,v=t[h+2]*b,p=t[h+3]*b,u=1;u<o;++u)g=i[u],l+=t[u+h]*g,_+=t[u+h+1]*g,v+=t[u+h+2]*g,p+=t[u+h+3]*g;a[d+h]=l,a[d+h+1]=_,a[d+h+2]=v,a[d+h+3]=p}for(;h<r;++h){for(l=t[h]*b,u=1;u<o;++u)l+=t[u+h]*i[u];a[d+h]=l}c+=r,d+=r}for(s=0;s<r;++s){for(l=a[s],h=0;h<n;++h)t[h]=l;for(u=s,h=0;h<=f-2;h+=2,u+=w)t[h+n]=a[u],t[h+n+1]=a[u+r];for(;h<f;++h,u+=r)t[h+n]=a[u];for(l=a[(f-1)*r+s],h=f;h<n+f;++h)t[h+n]=l;for(d=s,h=0;h<=f-4;h+=4,d+=m){for(l=t[h]*b,_=t[h+1]*b,v=t[h+2]*b,p=t[h+3]*b,u=1;u<o;++u)g=i[u],l+=t[u+h]*g,_+=t[u+h+1]*g,v+=t[u+h+2]*g,p+=t[u+h+3]*g;a[d]=l,a[d+r]=_,a[d+w]=v,a[d+y]=p}for(;h<f;++h,d+=r){for(l=t[h]*b,u=1;u<o;++u)l+=t[u+h]*i[u];a[d]=l}}};return{grayscale:function(t,e){for(var a=0|t.length,r=a-16|0,f=0,i=4899,o=9617,n=1868,s=0;s<=r;s+=16,f+=4)e[f]=t[s]*i+t[s+1]*o+t[s+2]*n+8192>>14,e[f+1]=t[s+4]*i+t[s+5]*o+t[s+6]*n+8192>>14,e[f+2]=t[s+8]*i+t[s+9]*o+t[s+10]*n+8192>>14,e[f+3]=t[s+12]*i+t[s+13]*o+t[s+14]*n+8192>>14;for(;s<a;s+=4,++f)e[f]=t[s]*i+t[s+1]*o+t[s+2]*n+8192>>14},resample:function(a,r,f,i){var o=a.rows,n=a.cols;o>i&&n>f&&(a.type&jsfeat.U8_t&&r.type&jsfeat.U8_t&&o*n/(i*f)<256?t(a,r,f,i):e(a,r,f,i))},box_blur_gray:function(t,e,a,r){"undefined"==typeof r&&(r=0);var f=t.cols,i=t.rows,o=i<<1,n=f<<1,s=0,h=0,u=0,c=0,d=(a<<1)+1|0,l=a+1|0,_=l+1|0,v=8192,p=r&jsfeat.BOX_BLUR_NOSCALE?1:16384/(d*d)+.5|0,b=jsfeat.cache.get_buffer(f*i<<2),g=0,w=0,y=0,m=0,j=0,M=b.i32,x=t.data,k=0;for(u=0;u<i;++u){for(w=u,g=l*x[y],s=y+1|0,c=y+a|0;s<=c;++s)g+=x[s];for(m=y+l|0,j=y,k=x[j],h=0;h<a;++h,w+=i)M[w]=g,g+=x[m]-k,m++;for(;h<f-_;h+=2,w+=o)M[w]=g,g+=x[m]-x[j],M[w+i]=g,g+=x[m+1]-x[j+1],m+=2,j+=2;for(;h<f-l;++h,w+=i)M[w]=g,g+=x[m]-x[j],m++,j++;for(k=x[m-1];h<f;++h,w+=i)M[w]=g,g+=k-x[j],j++;y+=f}if(y=0,x=e.data,1==p)for(u=0;u<f;++u){for(w=u,g=l*M[y],s=y+1|0,c=y+a|0;s<=c;++s)g+=M[s];for(m=y+l,j=y,k=M[j],h=0;h<a;++h,w+=f)x[w]=g,g+=M[m]-k,m++;for(;h<i-_;h+=2,w+=n)x[w]=g,g+=M[m]-M[j],x[w+f]=g,g+=M[m+1]-M[j+1],m+=2,j+=2;for(;h<i-l;++h,w+=f)x[w]=g,g+=M[m]-M[j],m++,j++;for(k=M[m-1];h<i;++h,w+=f)x[w]=g,g+=k-M[j],j++;y+=i}else for(u=0;u<f;++u){for(w=u,g=l*M[y],s=y+1|0,c=y+a|0;s<=c;++s)g+=M[s];for(m=y+l,j=y,k=M[j],h=0;h<a;++h,w+=f)x[w]=g*p+v>>14,g+=M[m]-k,m++;for(;h<i-_;h+=2,w+=n)x[w]=g*p+v>>14,g+=M[m]-M[j],x[w+f]=g*p+v>>14,g+=M[m+1]-M[j+1],m+=2,j+=2;for(;h<i-l;++h,w+=f)x[w]=g*p+v>>14,g+=M[m]-M[j],m++,j++;for(k=M[m-1];h<i;++h,w+=f)x[w]=g*p+v>>14,g+=k-M[j],j++;y+=i}jsfeat.cache.put_buffer(b)},gaussian_blur:function(t,e,f,i){"undefined"==typeof i&&(i=0),"undefined"==typeof f&&(f=0),f=0==f?2*Math.max(1,4*i+1-1e-8)+1|0:f;var o,n,s=f>>1,h=t.cols,u=t.rows,c=t.type,d=c&jsfeat.U8_t,l=t.data,_=e.data,v=f+Math.max(u,h)|0,p=jsfeat.cache.get_buffer(v<<2),b=jsfeat.cache.get_buffer(f<<2);d?(o=p.u8,n=b.i32):c&jsfeat.S32_t?(o=p.i32,n=b.f32):(o=p.f32,n=b.f32),jsfeat.math.get_gaussian_kernel(f,i,n,c),d?a(o,l,_,h,u,n,f,s):r(o,l,_,h,u,n,f,s),jsfeat.cache.put_buffer(p),jsfeat.cache.put_buffer(b)},pyrdown:function(t,e){var a=t.cols,r=t.rows,f=a>>1,i=r>>1,o=0,n=0,s=0,h=0,u=0,c=t.data,d=e.data;for(n=0;n<i;++n){for(h=s,o=0;o<=f-2;o+=2,u+=2,h+=4)d[u]=c[h]+c[h+1]+c[h+a]+c[h+a+1]+2>>2,d[u+1]=c[h+2]+c[h+3]+c[h+a+2]+c[h+a+3]+2>>2;for(;o<f;++o,++u,h+=2)d[u]=c[h]+c[h+1]+c[h+a]+c[h+a+1]+2>>2;s+=a<<1}},scharr_derivatives:function(t,e){var a,r,f,i,o,n,s,h,u=t.cols,c=t.rows,d=u<<1,l=0,_=0,v=0,p=0,b=0,g=0,w=0,y=t.data,m=jsfeat.cache.get_buffer(u+2<<2),j=jsfeat.cache.get_buffer(u+2<<2);for(t.type&jsfeat.U8_t||t.type&jsfeat.S32_t?(s=m.i32,h=j.i32):(s=m.f32,h=j.f32);_<c;++_,b+=u){for(p=(_>0?_-1:1)*u|0,g=(_<c-1?_+1:c-2)*u|0,w=_*d|0,l=0,v=1;l<=u-2;l+=2,v+=2)a=y[p+l],r=y[g+l],s[v]=3*(a+r)+10*y[b+l],h[v]=r-a,a=y[p+l+1],r=y[g+l+1],s[v+1]=3*(a+r)+10*y[b+l+1],h[v+1]=r-a;for(;l<u;++l,++v)a=y[p+l],r=y[g+l],s[v]=3*(a+r)+10*y[b+l],h[v]=r-a;for(l=u+1|0,s[0]=s[1],s[l]=s[u],h[0]=h[1],h[l]=h[u],l=0;l<=u-4;l+=4)a=h[l+2],r=h[l+1],f=h[l+3],i=h[l+4],o=s[l+2],n=s[l+3],e[w++]=o-s[l],e[w++]=3*(a+h[l])+10*r,e[w++]=n-s[l+1],e[w++]=3*(f+r)+10*a,e[w++]=s[l+4]-o,e[w++]=3*(i+a)+10*f,e[w++]=s[l+5]-n,e[w++]=3*(h[l+5]+f)+10*i;for(;l<u;++l)e[w++]=s[l+2]-s[l],e[w++]=3*(h[l+2]+h[l])+10*h[l+1]}jsfeat.cache.put_buffer(m),jsfeat.cache.put_buffer(j)},sobel_derivatives:function(t,e){var a,r,f,i,o,n,s,h,u=t.cols,c=t.rows,d=u<<1,l=0,_=0,v=0,p=0,b=0,g=0,w=0,y=t.data,m=jsfeat.cache.get_buffer(u+2<<2),j=jsfeat.cache.get_buffer(u+2<<2);for(t.type&jsfeat.U8_t||t.type&jsfeat.S32_t?(s=m.i32,h=j.i32):(s=m.f32,h=j.f32);_<c;++_,b+=u){for(p=(_>0?_-1:1)*u|0,g=(_<c-1?_+1:c-2)*u|0,w=_*d|0,l=0,v=1;l<=u-2;l+=2,v+=2)a=y[p+l],r=y[g+l],s[v]=a+r+2*y[b+l],h[v]=r-a,a=y[p+l+1],r=y[g+l+1],s[v+1]=a+r+2*y[b+l+1],h[v+1]=r-a;for(;l<u;++l,++v)a=y[p+l],r=y[g+l],s[v]=a+r+2*y[b+l],h[v]=r-a;for(l=u+1|0,s[0]=s[1],s[l]=s[u],h[0]=h[1],h[l]=h[u],l=0;l<=u-4;l+=4)a=h[l+2],r=h[l+1],f=h[l+3],i=h[l+4],o=s[l+2],n=s[l+3],e[w++]=o-s[l],e[w++]=a+h[l]+2*r,e[w++]=n-s[l+1],e[w++]=f+r+2*a,e[w++]=s[l+4]-o,e[w++]=i+a+2*f,e[w++]=s[l+5]-n,e[w++]=h[l+5]+f+2*i;for(;l<u;++l)e[w++]=s[l+2]-s[l],e[w++]=h[l+2]+h[l]+2*h[l+1]}jsfeat.cache.put_buffer(m),jsfeat.cache.put_buffer(j)},compute_integral_image:function(t,e,a,r){var f=0|t.cols,i=0|t.rows,o=t.data,n=f+1|0,s=0,h=0,u=0,c=0,d=0,l=0,_=0,v=0;if(e&&a){for(;d<n;++d)e[d]=0,a[d]=0;for(u=n+1|0,c=1,d=0,v=0;d<i;++d,++u,++c){for(s=h=0,l=0;l<=f-2;l+=2,v+=2,u+=2,c+=2)_=o[v],s+=_,h+=_*_,e[u]=e[c]+s,a[u]=a[c]+h,_=o[v+1],s+=_,h+=_*_,e[u+1]=e[c+1]+s,a[u+1]=a[c+1]+h;for(;l<f;++l,++v,++u,++c)_=o[v],s+=_,h+=_*_,e[u]=e[c]+s,a[u]=a[c]+h}}else if(e){for(;d<n;++d)e[d]=0;for(u=n+1|0,c=1,d=0,v=0;d<i;++d,++u,++c){for(s=0,l=0;l<=f-2;l+=2,v+=2,u+=2,c+=2)s+=o[v],e[u]=e[c]+s,s+=o[v+1],e[u+1]=e[c+1]+s;for(;l<f;++l,++v,++u,++c)s+=o[v],e[u]=e[c]+s}}else if(a){for(;d<n;++d)a[d]=0;for(u=n+1|0,c=1,d=0,v=0;d<i;++d,++u,++c){for(h=0,l=0;l<=f-2;l+=2,v+=2,u+=2,c+=2)_=o[v],h+=_*_,a[u]=a[c]+h,_=o[v+1],h+=_*_,a[u+1]=a[c+1]+h;for(;l<f;++l,++v,++u,++c)_=o[v],h+=_*_,a[u]=a[c]+h}}if(r){for(d=0;d<n;++d)r[d]=0;for(u=n+1|0,c=0,d=0,v=0;d<i;++d,++u,++c){for(l=0;l<=f-2;l+=2,v+=2,u+=2,c+=2)r[u]=o[v]+r[c],r[u+1]=o[v+1]+r[c+1];for(;l<f;++l,++v,++u,++c)r[u]=o[v]+r[c]}for(u=n+f|0,c=f,d=0;d<i;++d,u+=n,c+=n)r[u]+=r[c];for(l=f-1;l>0;--l)for(u=l+i*n,c=u-n,d=i;d>0;--d,u-=n,c-=n)r[u]+=r[c]+r[c+1]}},equalize_histogram:function(t,e){var a,r,f=t.cols,i=t.rows,o=t.data,n=e.data,s=f*i,h=0,u=0,c=jsfeat.cache.get_buffer(1024);for(a=c.i32;h<256;++h)a[h]=0;for(h=0;h<s;++h)++a[o[h]];for(u=a[0],h=1;h<256;++h)u=a[h]+=u;for(r=255/s,h=0;h<s;++h)n[h]=a[o[h]]*r+.5|0;jsfeat.cache.put_buffer(c)},canny:function(t,e,a,r){var f=t.cols,i=t.rows,o=(t.data,e.data),n=0,s=0,h=0,u=f<<1,c=0,d=0,l=0,_=0,v=0,p=0,b=0,g=0,w=jsfeat.cache.get_buffer(i*u<<2),y=jsfeat.cache.get_buffer(3*(f+2)<<2),m=jsfeat.cache.get_buffer((i+2)*(f+2)<<2),j=jsfeat.cache.get_buffer(i*f<<2),M=y.i32,x=m.i32,k=j.i32,A=w.i32,z=1,I=f+2+1|0,q=2*(f+2)+1|0,S=f+2|0,U=S+1|0,C=0;for(this.sobel_derivatives(t,A),a>r&&(n=a,a=r,r=n),n=3*(f+2)|0;--n>=0;)M[n]=0;for(n=(i+2)*(f+2)|0;--n>=0;)x[n]=0;for(;s<f;++s,h+=2)_=A[h],v=A[h+1],M[I+s]=(_^_>>31)-(_>>31)+((v^v>>31)-(v>>31));for(n=1;n<=i;++n,h+=u){if(n==i)for(s=q+f;--s>=q;)M[s]=0;else for(s=0;s<f;s++)_=A[h+(s<<1)],v=A[h+(s<<1)+1],M[q+s]=(_^_>>31)-(_>>31)+((v^v>>31)-(v>>31));for(c=h-u|0,x[U-1]=0,d=0,s=0;s<f;++s,c+=2){if(l=M[I+s],l>a)if(_=A[c],v=A[c+1],p=_^v,_=(_^_>>31)-(_>>31)|0,v=(v^v>>31)-(v>>31)|0,b=13573*_,g=b+(_+_<<15),v<<=15,v<b){if(l>M[I+s-1]&&l>=M[I+s+1]){l>r&&!d&&2!=x[U+s-S]?(x[U+s]=2,d=1,k[C++]=U+s):x[U+s]=1;continue}}else if(v>g){if(l>M[z+s]&&l>=M[q+s]){l>r&&!d&&2!=x[U+s-S]?(x[U+s]=2,d=1,k[C++]=U+s):x[U+s]=1;continue}}else if(p=p<0?-1:1,l>M[z+s-p]&&l>M[q+s+p]){l>r&&!d&&2!=x[U+s-S]?(x[U+s]=2,d=1,k[C++]=U+s):x[U+s]=1;continue}x[U+s]=0,d=0}x[U+f]=0,U+=S,s=z,z=I,I=q,q=s}for(s=U-S-1,n=0;n<S;++n,++s)x[s]=0;for(;C>0;)U=k[--C],U-=S+1,1==x[U]&&(x[U]=2,k[C++]=U),U+=1,1==x[U]&&(x[U]=2,k[C++]=U),U+=1,1==x[U]&&(x[U]=2,k[C++]=U),U+=S,1==x[U]&&(x[U]=2,k[C++]=U),U-=2,1==x[U]&&(x[U]=2,k[C++]=U),U+=S,1==x[U]&&(x[U]=2,k[C++]=U),U+=1,1==x[U]&&(x[U]=2,k[C++]=U),U+=1,1==x[U]&&(x[U]=2,k[C++]=U);for(U=S+1,z=0,n=0;n<i;++n,U+=S)for(s=0;s<f;++s)o[z++]=255*(2==x[U+s]);jsfeat.cache.put_buffer(w),jsfeat.cache.put_buffer(y),jsfeat.cache.put_buffer(m),jsfeat.cache.put_buffer(j)},warp_perspective:function(t,e,a,r){"undefined"==typeof r&&(r=0);for(var f=t.cols,i=t.rows,o=e.cols,n=e.rows,s=t.data,h=e.data,u=0,c=0,d=0,l=0,_=0,v=0,p=0,b=0,g=0,w=0,y=0,m=0,j=0,M=0,x=0,k=a[0],A=a[1],z=a[2],I=a[3],q=a[4],S=a[5],U=a[6],C=a[7],D=a[8],L=0;c<n;++c)for(b=A*c+z,g=q*c+S,w=C*c+D,u=0;u<o;++u,++L,b+=k,g+=I,w+=U)y=1/w,v=b*y,p=g*y,l=0|v,_=0|p,v>0&&p>0&&l<f-1&&_<i-1?(m=Math.max(v-l,0),j=Math.max(p-_,0),d=f*_+l,M=s[d]+m*(s[d+1]-s[d]),x=s[d+f]+m*(s[d+f+1]-s[d+f]),h[L]=M+j*(x-M)):h[L]=r},warp_affine:function(t,e,a,r){"undefined"==typeof r&&(r=0);for(var f=t.cols,i=t.rows,o=e.cols,n=e.rows,s=t.data,h=e.data,u=0,c=0,d=0,l=0,_=0,v=0,p=0,b=0,g=0,w=0,y=0,m=a[0],j=a[1],M=a[2],x=a[3],k=a[4],A=a[5],z=0;c<n;++c)for(v=j*c+M,p=k*c+A,u=0;u<o;++u,++z,v+=m,p+=x)l=0|v,_=0|p,v>0&&p>0&&l<f-1&&_<i-1?(b=Math.max(v-l,0),g=Math.max(p-_,0),d=f*_+l,w=s[d]+b*(s[d+1]-s[d]),y=s[d+f]+b*(s[d+f+1]-s[d+f]),h[z]=w+g*(y-w)):h[z]=r}}}();t.imgproc=e}(jsfeat),function(t){var e=function(){var t=new Int32Array([0,3,1,3,2,2,3,1,3,0,3,-1,2,-2,1,-3,0,-3,-1,-3,-2,-2,-3,-1,-3,0,-3,1,-2,2,-1,3]),e=new Uint8Array(512),a=new Int32Array(25),r=new Int32Array(25),f=function(e,a,r){for(var f=0,i=t;f<r;++f)e[f]=i[f<<1]+i[(f<<1)+1]*a;for(;f<25;++f)e[f]=e[f-r]},i=function(t,e,a,r,f){for(var i=25,o=0,n=t[e],s=f,h=0,u=0,c=0;o<i;++o)r[o]=n-t[e+a[o]];for(o=0;o<16;o+=2)h=Math.min(r[o+1],r[o+2]),h=Math.min(h,r[o+3]),h<=s||(h=Math.min(h,r[o+4]),h=Math.min(h,r[o+5]),h=Math.min(h,r[o+6]),h=Math.min(h,r[o+7]),h=Math.min(h,r[o+8]),s=Math.max(s,Math.min(h,r[o])),s=Math.max(s,Math.min(h,r[o+9])));for(u=-s,o=0;o<16;o+=2)c=Math.max(r[o+1],r[o+2]),c=Math.max(c,r[o+3]),c=Math.max(c,r[o+4]),c=Math.max(c,r[o+5]),c>=u||(c=Math.max(c,r[o+6]),c=Math.max(c,r[o+7]),c=Math.max(c,r[o+8]),u=Math.min(u,Math.max(c,r[o])),u=Math.min(u,Math.max(c,r[o+9])));return-u-1},o=20;return{set_threshold:function(t){o=Math.min(Math.max(t,0),255);for(var a=-255;a<=255;++a)e[a+255]=a<-o?1:a>o?2:0;return o},detect:function(t,n,s){"undefined"==typeof s&&(s=3);var h,u=8,c=25,d=t.data,l=t.cols,_=t.rows,v=0,p=0,b=0,g=0,w=0,y=0,m=jsfeat.cache.get_buffer(3*l),j=jsfeat.cache.get_buffer(3*(l+1)<<2),M=m.u8,x=j.i32,k=a,A=r,z=Math.max(3,s),I=Math.min(_-2,_-s),q=Math.max(3,s),S=Math.min(l-3,l-s),U=0,C=0,D=i,L=e,V=o,N=0,O=0,E=0,F=0,T=0,B=0,P=0,R=0,X=0,H=0,G=0,J=0;f(k,l,16);var K=k[0],Q=k[1],W=k[2],Y=k[3],Z=k[4],$=k[5],tt=k[6],et=k[7],at=k[8],rt=k[9],ft=k[10],it=k[11],ot=k[12],nt=k[13],st=k[14],ht=k[15];for(v=0;v<3*l;++v)M[v]=0;for(v=z;v<I;++v){for(P=v*l+q|0,y=(v-3)%3,B=y*l|0,T=y*(l+1)|0,p=0;p<l;++p)M[B+p]=0;if(F=0,v<I-1)for(p=q;p<S;++p,++P)if(N=d[P],O=-N+255,E=L[O+d[P+K]]|L[O+d[P+at]],0!=E&&(E&=L[O+d[P+W]]|L[O+d[P+ft]],E&=L[O+d[P+Z]]|L[O+d[P+ot]],E&=L[O+d[P+tt]]|L[O+d[P+st]],0!=E)){if(E&=L[O+d[P+Q]]|L[O+d[P+rt]],E&=L[O+d[P+Y]]|L[O+d[P+it]],E&=L[O+d[P+$]]|L[O+d[P+nt]],E&=L[O+d[P+et]]|L[O+d[P+ht]],1&E)for(g=N-V,U=0,b=0;b<c;++b)if(w=d[P+k[b]],w<g){if(++U,U>u){++F,x[T+F]=p,M[B+p]=D(d,P,k,A,V);break}}else U=0;if(2&E)for(g=N+V,U=0,b=0;b<c;++b)if(w=d[P+k[b]],w>g){if(++U,U>u){++F,x[T+F]=p,M[B+p]=D(d,P,k,A,V);break}}else U=0}if(x[T+l]=F,v!=z)for(y=(v-4+3)%3,R=y*l|0,T=y*(l+1)|0,y=(v-5+3)%3,X=y*l|0,F=x[T+l],b=0;b<F;++b)p=x[T+b],H=p+1|0,G=p-1|0,J=M[R+p],J>M[R+H]&&J>M[R+G]&&J>M[X+G]&&J>M[X+p]&&J>M[X+H]&&J>M[B+G]&&J>M[B+p]&&J>M[B+H]&&(h=n[C],h.x=p,h.y=v-1,h.score=J,C++)}return jsfeat.cache.put_buffer(m),jsfeat.cache.put_buffer(j),C}}}();t.fast_corners=e,e.set_threshold(20)}(jsfeat),function(t){var e=function(){var t=function(t,e,a,r,f,i){var o=0,n=0,s=f*a|0,h=s;for(o=f;o<r-f;++o,s+=a,h=s)for(n=a-f;n>=f;--n)e[h]=-4*t[h]+t[h+f]+t[h-f]+t[h+i]+t[h-i],++h},e=function(t,e,a,r,f,i,o){var n=-2*t[e]+t[e+r]+t[e-r],s=-2*t[e]+t[e+f]+t[e-f],h=t[e+i]+t[e-i]-t[e+o]-t[e-o],u=0|Math.sqrt((n-s)*(n-s)+4*h*h);return Math.min(Math.abs(a-u),Math.abs(-(a+u)))};return{laplacian_threshold:30,min_eigen_value_threshold:25,detect:function(a,r){var f,i=0,o=0,n=a.cols,s=a.rows,h=a.data,u=5,c=5*n|0,d=3+3*n|0,l=3-3*n|0,_=jsfeat.cache.get_buffer(n*s<<2),v=_.i32,p=0,b=0,g=0,w=0,y=0,m=this.laplacian_threshold,j=this.min_eigen_value_threshold;for(i=n*s;--i>=0;)v[i]=0;for(t(h,v,n,s,u,c),b=n+1|0,o=1;o<s-1;++o,b+=n)for(i=1,g=b;i<n-1;++i,++g)p=v[g],(p<-m&&p<v[g-1]&&p<v[g+1]&&p<v[g-n]&&p<v[g+n]&&p<v[g-n-1]&&p<v[g+n-1]&&p<v[g-n+1]&&p<v[g+n+1]||p>m&&p>v[g-1]&&p>v[g+1]&&p>v[g-n]&&p>v[g+n]&&p>v[g-n-1]&&p>v[g+n-1]&&p>v[g-n+1]&&p>v[g+n+1])&&(w=e(h,g,p,u,c,d,l),
w>j&&(f=r[y],f.x=i,f.y=o,f.score=w,++y,++i,++g));return jsfeat.cache.put_buffer(_),y}}}();t.yape06=e}(jsfeat),function(t){var e=function(){var t=function(t,e,a){var r,f,i=0;for(r=a,f=0;f<r;f++,i++)r=Math.sqrt(a*a-f*f)+.5|0,e[i]=r+t*f;for(r--;r<f&&r>=0;r--,i++)f=Math.sqrt(a*a-r*r)+.5|0,e[i]=r+t*f;for(;-r<f;r--,i++)f=Math.sqrt(a*a-r*r)+.5|0,e[i]=r+t*f;for(f--;f>=0;f--,i++)r=-Math.sqrt(a*a-f*f)-.5|0,e[i]=r+t*f;for(;f>r;f--,i++)r=-Math.sqrt(a*a-f*f)-.5|0,e[i]=r+t*f;for(r++;r<=0;r++,i++)f=-Math.sqrt(a*a-r*r)-.5|0,e[i]=r+t*f;for(;r<-f;r++,i++)f=-Math.sqrt(a*a-r*r)-.5|0,e[i]=r+t*f;for(f++;f<0;f++,i++)r=Math.sqrt(a*a-f*f)+.5|0,e[i]=r+t*f;return e[i]=e[0],e[i+1]=e[1],i},e=function(t,e,a){var r=0;return 0!=t[e+1]&&r++,0!=t[e-1]&&r++,0!=t[e+a]&&r++,0!=t[e+a+1]&&r++,0!=t[e+a-1]&&r++,0!=t[e-a]&&r++,0!=t[e-a+1]&&r++,0!=t[e-a-1]&&r++,r},a=function(t,e,a,r,f){var i,o;if(a>0)for(e-=r*f,o=-f;o<=f;++o){for(i=-f;i<=f;++i)if(t[e+i]>a)return!1;e+=r}else for(e-=r*f,o=-f;o<=f;++o){for(i=-f;i<=f;++i)if(t[e+i]<a)return!1;e+=r}return!0},r=function(t,e,a,r,f,i,o,n){var s=0,h=0,u=o-1|0,c=0,d=0,l=0,_=0,v=0;if(c=t[e+i[h]],c<=f)if(c>=r)if(d=t[e+i[u]],d<=f){if(d>=r)return void(a[e]=0);if(u++,l=t[e+i[u]],l>f)if(u++,_=t[e+i[u]],_>f)v=3;else{if(!(_<r))return void(a[e]=0);v=6}else if(u++,_=t[e+i[u]],_>f)v=7;else{if(!(_<r))return void(a[e]=0);v=2}}else if(u++,l=t[e+i[u]],l>f)if(u++,_=t[e+i[u]],_>f)v=3;else{if(!(_<r))return void(a[e]=0);v=6}else{if(!(l<r))return void(a[e]=0);if(u++,_=t[e+i[u]],_>f)v=7;else{if(!(_<r))return void(a[e]=0);v=2}}else{if(d=t[e+i[u]],d>f)return void(a[e]=0);if(u++,l=t[e+i[u]],l>f)return void(a[e]=0);if(u++,_=t[e+i[u]],_>f)return void(a[e]=0);v=1}else{if(d=t[e+i[u]],d<r)return void(a[e]=0);if(u++,l=t[e+i[u]],l<r)return void(a[e]=0);if(u++,_=t[e+i[u]],_<r)return void(a[e]=0);v=0}for(h=1;h<=o;h++)switch(c=t[e+i[h]],v){case 0:if(c>f){if(l=_,u++,_=t[e+i[u]],_<r)return void(a[e]=0);s-=c+l,v=0;break}if(c<r){if(l>f)return void(a[e]=0);if(_>f)return void(a[e]=0);if(l=_,u++,_=t[e+i[u]],_>f)return void(a[e]=0);s-=c+l,v=8;break}if(l<=f)return void(a[e]=0);if(_<=f)return void(a[e]=0);if(l=_,u++,_=t[e+i[u]],_>f){s-=c+l,v=3;break}if(_<r){s-=c+l,v=6;break}return void(a[e]=0);case 1:if(c<r){if(l=_,u++,_=t[e+i[u]],_>f)return void(a[e]=0);s-=c+l,v=1;break}if(c>f){if(l<r)return void(a[e]=0);if(_<r)return void(a[e]=0);if(l=_,u++,_=t[e+i[u]],_<r)return void(a[e]=0);s-=c+l,v=9;break}if(l>=r)return void(a[e]=0);if(_>=r)return void(a[e]=0);if(l=_,u++,_=t[e+i[u]],_<r){s-=c+l,v=2;break}if(_>f){s-=c+l,v=7;break}return void(a[e]=0);case 2:if(c>f)return void(a[e]=0);if(l=_,u++,_=t[e+i[u]],c<r){if(_>f)return void(a[e]=0);s-=c+l,v=4;break}if(_>f){s-=c+l,v=7;break}if(_<r){s-=c+l,v=2;break}return void(a[e]=0);case 3:if(c<r)return void(a[e]=0);if(l=_,u++,_=t[e+i[u]],c>f){if(_<r)return void(a[e]=0);s-=c+l,v=5;break}if(_>f){s-=c+l,v=3;break}if(_<r){s-=c+l,v=6;break}return void(a[e]=0);case 4:if(c>f)return void(a[e]=0);if(c<r){if(l=_,u++,_=t[e+i[u]],_>f)return void(a[e]=0);s-=c+l,v=1;break}if(_>=r)return void(a[e]=0);if(l=_,u++,_=t[e+i[u]],_<r){s-=c+l,v=2;break}if(_>f){s-=c+l,v=7;break}return void(a[e]=0);case 5:if(c<r)return void(a[e]=0);if(c>f){if(l=_,u++,_=t[e+i[u]],_<r)return void(a[e]=0);s-=c+l,v=0;break}if(_<=f)return void(a[e]=0);if(l=_,u++,_=t[e+i[u]],_>f){s-=c+l,v=3;break}if(_<r){s-=c+l,v=6;break}return void(a[e]=0);case 7:if(c>f)return void(a[e]=0);if(c<r)return void(a[e]=0);if(l=_,u++,_=t[e+i[u]],_>f){s-=c+l,v=3;break}if(_<r){s-=c+l,v=6;break}return void(a[e]=0);case 6:if(c>f)return void(a[e]=0);if(c<r)return void(a[e]=0);if(l=_,u++,_=t[e+i[u]],_<r){s-=c+l,v=2;break}if(_>f){s-=c+l,v=7;break}return void(a[e]=0);case 8:if(c>f){if(_<r)return void(a[e]=0);if(l=_,u++,_=t[e+i[u]],_<r)return void(a[e]=0);s-=c+l,v=9;break}if(c<r){if(l=_,u++,_=t[e+i[u]],_>f)return void(a[e]=0);s-=c+l,v=1;break}return void(a[e]=0);case 9:if(c<r){if(_>f)return void(a[e]=0);if(l=_,u++,_=t[e+i[u]],_>f)return void(a[e]=0);s-=c+l,v=8;break}if(c>f){if(l=_,u++,_=t[e+i[u]],_<r)return void(a[e]=0);s-=c+l,v=0;break}return void(a[e]=0)}a[e]=s+n*t[e]},f=function(){function e(e,a,r){this.dirs=new Int32Array(1024),this.dirs_count=0|t(e,this.dirs,r),this.scores=new Int32Array(e*a),this.radius=0|r}return e}();return{level_tables:[],tau:7,init:function(t,e,a,r){"undefined"==typeof r&&(r=1);var i;for(a=Math.min(a,7),a=Math.max(a,3),i=0;i<r;++i)this.level_tables[i]=new f(t>>i,e>>i,a)},detect:function(t,f,i){"undefined"==typeof i&&(i=4);var o,n=this.level_tables[0],s=0|n.radius,h=s-1|0,u=n.dirs,c=0|n.dirs_count,d=c>>1,l=t.data,_=0|t.cols,v=0|t.rows,p=_>>1,b=n.scores,g=0,w=0,y=0,m=0,j=0,M=0,x=0,k=0,A=0|this.tau,z=0,I=0|Math.max(s+1,i),q=0|Math.max(s+1,i),S=0|Math.min(_-s-2,_-i),U=0|Math.min(v-s-2,v-i);for(y=q*_+I|0,w=q;w<U;++w,y+=_)for(g=I,m=y;g<S;++g,++m)j=l[m]+A,M=l[m]-A,M<l[m+s]&&l[m+s]<j&&M<l[m-s]&&l[m-s]<j?b[m]=0:r(l,m,b,M,j,u,d,c);for(y=q*_+I|0,w=q;w<U;++w,y+=_)for(g=I,m=y;g<S;++g,++m)k=b[m],x=Math.abs(k),x<5?(++g,++m):e(b,m,_)>=3&&a(b,m,k,p,s)&&(o=f[z],o.x=g,o.y=w,o.score=x,++z,g+=h,m+=h);return z}}}();t.yape=e}(jsfeat),function(t){var e=function(){var t=jsfeat.imgproc.scharr_derivatives;return{track:function(e,a,r,f,i,o,n,s,h,u){"undefined"==typeof n&&(n=30),"undefined"==typeof s&&(s=new Uint8Array(i)),"undefined"==typeof h&&(h=.01),"undefined"==typeof u&&(u=1e-4);var c=.5*(o-1),d=o*o|0,l=d<<1,_=e.data,v=a.data,p=_[0].data,b=v[0].data,g=_[0].cols,w=_[0].rows,y=0,m=0,j=jsfeat.cache.get_buffer(d<<2),M=jsfeat.cache.get_buffer(l<<2),x=jsfeat.cache.get_buffer(w*(g<<1)<<2),k=j.i32,A=M.i32,z=x.i32,I=0,q=0,S=0,U=0,C=0,D=0,L=0,V=0,N=0,O=0,E=0,F=0,T=0,B=0,P=0,R=0,X=0,H=0,G=0,J=0,K=0,Q=0,W=0,Y=0,Z=0,$=0,tt=0,et=0,at=0,rt=0,ft=0,it=0,ot=0,nt=14,st=14,ht=st-5,ut=1<<ht-1,ct=1<<nt,dt=1<<st-1,lt=1/(1<<20),_t=0,vt=0,pt=0,bt=0,gt=0,wt=0,yt=0,mt=0,jt=0,Mt=0,xt=0,kt=0,At=1.1920929e-7;for(h*=h;J<i;++J)s[J]=1;var zt=e.levels-1|0;for(Y=zt;Y>=0;--Y)for(L=1/(1<<Y),y=g>>Y,m=w>>Y,I=y<<1,p=_[Y].data,b=v[Y].data,et=y-o|0,at=m-o|0,t(_[Y],z),Z=0;Z<i;++Z)if(J=Z<<1,K=J+1,V=r[J]*L,N=r[K]*L,Y==zt?(O=V,E=N):(O=2*f[J],E=2*f[K]),f[J]=O,f[K]=E,V-=c,N-=c,R=0|V,X=0|N,Q=R<=tt|R>=et|X<=tt|X>=at,0==Q){for(rt=V-R,ft=N-X,_t=(1-rt)*(1-ft)*ct+.5|0,vt=rt*(1-ft)*ct+.5|0,pt=(1-rt)*ft*ct+.5|0,bt=ct-_t-vt-pt,mt=0,jt=0,Mt=0,W=0;W<o;++W)for(q=(W+X)*y+R|0,S=q<<1,U=W*o|0,C=U<<1,Q=0;Q<o;++Q,++q,++U,S+=2)gt=p[q]*_t+p[q+1]*vt+p[q+y]*pt+p[q+y+1]*bt,gt=gt+ut>>ht,wt=z[S]*_t+z[S+2]*vt+z[S+I]*pt+z[S+I+2]*bt,wt=wt+dt>>st,yt=z[S+1]*_t+z[S+3]*vt+z[S+I+1]*pt+z[S+I+3]*bt,yt=yt+dt>>st,k[U]=gt,A[C++]=wt,A[C++]=yt,mt+=wt*wt,jt+=wt*yt,Mt+=yt*yt;if(mt*=lt,jt*=lt,Mt*=lt,xt=mt*Mt-jt*jt,kt=(Mt+mt-Math.sqrt((mt-Mt)*(mt-Mt)+4*jt*jt))/l,kt<u||xt<At)0==Y&&(s[Z]=0);else for(xt=1/xt,O-=c,E-=c,F=0,T=0,$=0;$<n;++$){if(H=0|O,G=0|E,Q=H<=tt|H>=et|G<=tt|G>=at,0!=Q){0==Y&&(s[Z]=0);break}for(rt=O-H,ft=E-G,_t=(1-rt)*(1-ft)*ct+.5|0,vt=rt*(1-ft)*ct+.5|0,pt=(1-rt)*ft*ct+.5|0,bt=ct-_t-vt-pt,it=0,ot=0,W=0;W<o;++W)for(D=(W+G)*y+H|0,U=W*o|0,C=U<<1,Q=0;Q<o;++Q,++D,++U)gt=b[D]*_t+b[D+1]*vt+b[D+y]*pt+b[D+y+1]*bt,gt=gt+ut>>ht,gt-=k[U],it+=gt*A[C++],ot+=gt*A[C++];if(it*=lt,ot*=lt,B=(jt*ot-Mt*it)*xt,P=(jt*it-mt*ot)*xt,O+=B,E+=P,f[J]=O+c,f[K]=E+c,B*B+P*P<=h)break;if($>0&&Math.abs(B+F)<.01&&Math.abs(P+T)<.01){f[J]-=.5*B,f[K]-=.5*P;break}F=B,T=P}}else 0==Y&&(s[Z]=0);jsfeat.cache.put_buffer(j),jsfeat.cache.put_buffer(M),jsfeat.cache.put_buffer(x)}}}();t.optical_flow_lk=e}(jsfeat),function(t){var e=function(){var t=function(t,e){var a=.25*t.width+.5|0;return e.x<=t.x+a&&e.x>=t.x-a&&e.y<=t.y+a&&e.y>=t.y-a&&e.width<=1.5*t.width+.5|0&&1.5*e.width+.5|0>=t.width};return{edges_density:.07,detect_single_scale:function(t,e,a,r,f,i,o,n){var s,h,u,c,d,l,_,v,p,b,g,w,y,m,j,M,x,k,A,z,I,q,S,U,C,D,L=n.size[0]*o|0,V=n.size[1]*o|0,N=.5*o+1.5|0,O=N,E=f-L|0,F=i-V|0,T=f+1|0,B=1/(L*V),P=!0,R=0,X=L,H=V*T,G=H+L,J=L*V*255*this.edges_density|0,K=[];for(d=0;d<F;d+=O)for(R=d*T,c=0;c<E;c+=N,R+=N)if(_=t[R]-t[R+X]-t[R+H]+t[R+G],r&&(l=r[R]-r[R+X]-r[R+H]+r[R+G],l<J||_<20))c+=N,R+=N;else{for(_*=B,v=(e[R]-e[R+X]-e[R+H]+e[R+G])*B-_*_,p=v>0?Math.sqrt(v):1,b=n.complexClassifiers,m=b.length,P=!0,s=0;s<m;++s){for(g=b[s],x=g.threshold,w=g.simpleClassifiers,j=w.length,k=0,h=0;h<j;++h){if(y=w[h],A=0,I=y.features,M=I.length,1===y.tilted)for(u=0;u<M;++u)z=I[u],q=~~(c+z[0]*o)+~~(d+z[1]*o)*T,C=~~(z[2]*o),D=~~(z[3]*o),S=C*T,U=D*T,A+=(a[q]-a[q+C+S]-a[q-D+U]+a[q+C-D+S+U])*z[4];else for(u=0;u<M;++u)z=I[u],q=~~(c+z[0]*o)+~~(d+z[1]*o)*T,C=~~(z[2]*o),D=~~(z[3]*o),U=D*T,A+=(t[q]-t[q+C]-t[q+U]+t[q+U+C])*z[4];k+=A*B<y.threshold*p?y.left_val:y.right_val}if(k<x){P=!1;break}}P&&(K.push({x:c,y:d,width:L,height:V,neighbor:1,confidence:k}),c+=N,R+=N)}return K},detect_multi_scale:function(t,e,a,r,f,i,o,n,s){"undefined"==typeof n&&(n=1.2),"undefined"==typeof s&&(s=1);for(var h=o.size[0],u=o.size[1],c=[];s*h<f&&s*u<i;)c=c.concat(this.detect_single_scale(t,e,a,r,f,i,s,o)),s*=n;return c},group_rectangles:function(e,a){"undefined"==typeof a&&(a=1);var r,f,i=e.length,o=[];for(r=0;r<i;++r)o[r]={parent:-1,element:e[r],rank:0};for(r=0;r<i;++r)if(o[r].element){for(var n=r;o[n].parent!=-1;)n=o[n].parent;for(f=0;f<i;++f)if(r!=f&&o[f].element&&t(o[r].element,o[f].element)){for(var s=f;o[s].parent!=-1;)s=o[s].parent;if(s!=n){o[n].rank>o[s].rank?o[s].parent=n:(o[n].parent=s,o[n].rank==o[s].rank&&o[s].rank++,n=s);for(var h,u=f;o[u].parent!=-1;)h=u,u=o[u].parent,o[h].parent=n;for(u=r;o[u].parent!=-1;)h=u,u=o[u].parent,o[h].parent=n}}}var c=[],d=0;for(r=0;r<i;r++){f=-1;var l=r;if(o[l].element){for(;o[l].parent!=-1;)l=o[l].parent;o[l].rank>=0&&(o[l].rank=~d++),f=~o[l].rank}c[r]=f}var _=[];for(r=0;r<d+1;++r)_[r]={neighbors:0,x:0,y:0,width:0,height:0,confidence:0};for(r=0;r<i;++r){var v=e[r],p=c[r];0==_[p].neighbors&&(_[p].confidence=v.confidence),++_[p].neighbors,_[p].x+=v.x,_[p].y+=v.y,_[p].width+=v.width,_[p].height+=v.height,_[p].confidence=Math.max(_[p].confidence,v.confidence)}var b=[];for(r=0;r<d;++r)i=_[r].neighbors,i>=a&&b.push({x:(2*_[r].x+i)/(2*i),y:(2*_[r].y+i)/(2*i),width:(2*_[r].width+i)/(2*i),height:(2*_[r].height+i)/(2*i),neighbors:_[r].neighbors,confidence:_[r].confidence});var g=[];for(i=b.length,r=0;r<i;++r){var v=b[r],w=!0;for(f=0;f<i;++f){var y=b[f],m=.25*y.width+.5|0;if(r!=f&&v.x>=y.x-m&&v.y>=y.y-m&&v.x+v.width<=y.x+y.width+m&&v.y+v.height<=y.y+y.height+m&&(y.neighbors>Math.max(3,v.neighbors)||v.neighbors<3)){w=!1;break}}w&&g.push(v)}return g}}}();t.haar=e}(jsfeat),function(t){var e=function(){var t=function(t,e){var a=.25*t.width+.5|0;return e.x<=t.x+a&&e.x>=t.x-a&&e.y<=t.y+a&&e.y>=t.y-a&&e.width<=1.5*t.width+.5|0&&1.5*e.width+.5|0>=t.width};return{interval:4,scale:1.1486,next:5,scale_to:1,prepare_cascade:function(t){for(var e=t.stage_classifier.length,a=0;a<e;a++)for(var r=t.stage_classifier[a].feature,f=t.stage_classifier[a].count,i=t.stage_classifier[a]._feature=new Array(f),o=0;o<f;o++)i[o]={size:r[o].size,px:new Array(r[o].size),pz:new Array(r[o].size),nx:new Array(r[o].size),nz:new Array(r[o].size)}},build_pyramid:function(t,e,a,r,f){if("undefined"==typeof r&&(r=4),"undefined"==typeof f&&(f=!0),f){var i=t.getContext("2d"),o=t.width*t.height,n=i.getImageData(0,0,t.width,t.height),s=n.data,h=new Uint32Array(s.buffer),u=jsfeat.cache.get_buffer(o),c=u.u8;jsfeat.imgproc.grayscale(s,c);for(var d=255<<24,l=o,_=0;--l>=0;)_=c[l],h[l]=d|_<<16|_<<8|_;i.putImageData(n,0,0),jsfeat.cache.put_buffer(u)}this.interval=r,this.scale=Math.pow(2,1/(this.interval+1)),this.next=this.interval+1|0,this.scale_to=Math.log(Math.min(t.width/e,t.height/a))/Math.log(this.scale)|0;var v=document.createElement("canvas");v.width=t.width,v.height=t.height;var p=v.getContext("2d"),b=new Array(4*(this.scale_to+2*this.next));b[0]={width:t.width,height:t.height,data:t.getContext("2d").getImageData(0,0,t.width,t.height).data};var g,w;for(l=1;l<=this.interval;++l)g=t.width/Math.pow(this.scale,l)|0,w=t.height/Math.pow(this.scale,l)|0,p.drawImage(t,0,0,t.width,t.height,0,0,g,w),b[4*l]={width:g,height:w,data:p.getImageData(0,0,g,w).data};for(l=this.next;l<this.scale_to+2*this.next;++l)g=b[4*l-4*this.next].width>>1,w=b[4*l-4*this.next].height>>1,p.drawImage(t,0,0,t.width,t.height,0,0,g,w),b[4*l]={width:g,height:w,data:p.getImageData(0,0,g,w).data};for(l=2*this.next;l<this.scale_to+2*this.next;++l)g=b[4*l-4*this.next].width>>1,w=b[4*l-4*this.next].height>>1,p.drawImage(t,1,0,t.width-1,t.height,0,0,g-2,w),b[4*l+1]={width:g,height:w,data:p.getImageData(0,0,g,w).data},p.drawImage(t,0,1,t.width,t.height-1,0,0,g,w-2),b[4*l+2]={width:g,height:w,data:p.getImageData(0,0,g,w).data},p.drawImage(t,1,1,t.width-1,t.height-1,0,0,g-2,w-2),b[4*l+3]={width:g,height:w,data:p.getImageData(0,0,g,w).data};return b},detect:function(t,e){var a,r,f,i,o,n=(this.interval,this.scale),s=this.next,h=this.scale_to,u=0,c=0,d=0,l=0,_=0,v=0,p=0,b=0,g=0,w=0,y=0,m=0,j=0,M=0,x=0,k=0,A=0,z=0,I=!0,q=!0,S=1,U=1,C=[0,1,0,1],D=[0,0,1,1],L=[],V=[],N=[0,0,0],O=[0,0,0],E=[0,0,0];for(u=0;u<h;u++){for(x=u<<2,k=t[x+(s<<3)].width-(e.width>>2),A=t[x+(s<<3)].height-(e.height>>2),O[0]=t[x].width<<2,O[1]=t[x+(s<<2)].width<<2,O[2]=t[x+(s<<3)].width<<2,E[0]=(t[x].width<<4)-(k<<4),E[1]=(t[x+(s<<2)].width<<3)-(k<<3),E[2]=(t[x+(s<<3)].width<<2)-(k<<2),b=e.stage_classifier.length,c=0;c<b;c++)for(f=e.stage_classifier[c].feature,r=e.stage_classifier[c]._feature,g=e.stage_classifier[c].count,d=0;d<g;d++)for(i=r[d],o=f[d],w=0|o.size,p=0;p<w;p++)i.px[p]=(o.px[p]<<2)+o.py[p]*O[o.pz[p]],i.pz[p]=o.pz[p],i.nx[p]=(o.nx[p]<<2)+o.ny[p]*O[o.nz[p]],i.nz[p]=o.nz[p];for(V[0]=t[x].data,V[1]=t[x+(s<<2)].data,p=0;p<4;p++)for(V[2]=t[x+(s<<3)+p].data,N[0]=(C[p]<<3)+D[p]*(t[x].width<<3),N[1]=(C[p]<<2)+D[p]*(t[x+(s<<2)].width<<2),N[2]=0,v=0;v<A;v++){for(_=0;_<k;_++){for(z=0,I=!0,b=e.stage_classifier.length,c=0;c<b;c++){for(z=0,a=e.stage_classifier[c].alpha,r=e.stage_classifier[c]._feature,g=e.stage_classifier[c].count,d=0;d<g;d++)if(i=r[d],m=V[i.pz[0]][N[i.pz[0]]+i.px[0]],j=V[i.nz[0]][N[i.nz[0]]+i.nx[0]],m<=j)z+=a[d<<1];else{for(q=!0,w=i.size,M=0;M<w;M++){if(i.pz[M]>=0&&(y=V[i.pz[M]][N[i.pz[M]]+i.px[M]],y<m)){if(y<=j){q=!1;break}m=y}if(i.nz[M]>=0&&(l=V[i.nz[M]][N[i.nz[M]]+i.nx[M]],l>j)){if(m<=l){q=!1;break}j=l}}z+=q?a[(d<<1)+1]:a[d<<1]}if(z<e.stage_classifier[c].threshold){I=!1;break}}I&&L.push({x:(4*_+2*C[p])*S,y:(4*v+2*D[p])*U,width:e.width*S,height:e.height*U,neighbor:1,confidence:z}),N[0]+=16,N[1]+=8,N[2]+=4}N[0]+=E[0],N[1]+=E[1],N[2]+=E[2]}S*=n,U*=n}return L},group_rectangles:function(e,a){"undefined"==typeof a&&(a=1);var r,f,i=e.length,o=[];for(r=0;r<i;++r)o[r]={parent:-1,element:e[r],rank:0};for(r=0;r<i;++r)if(o[r].element){for(var n=r;o[n].parent!=-1;)n=o[n].parent;for(f=0;f<i;++f)if(r!=f&&o[f].element&&t(o[r].element,o[f].element)){for(var s=f;o[s].parent!=-1;)s=o[s].parent;if(s!=n){o[n].rank>o[s].rank?o[s].parent=n:(o[n].parent=s,o[n].rank==o[s].rank&&o[s].rank++,n=s);for(var h,u=f;o[u].parent!=-1;)h=u,u=o[u].parent,o[h].parent=n;for(u=r;o[u].parent!=-1;)h=u,u=o[u].parent,o[h].parent=n}}}var c=[],d=0;for(r=0;r<i;r++){f=-1;var l=r;if(o[l].element){for(;o[l].parent!=-1;)l=o[l].parent;o[l].rank>=0&&(o[l].rank=~d++),f=~o[l].rank}c[r]=f}var _=[];for(r=0;r<d+1;++r)_[r]={neighbors:0,x:0,y:0,width:0,height:0,confidence:0};for(r=0;r<i;++r){var v=e[r],p=c[r];0==_[p].neighbors&&(_[p].confidence=v.confidence),++_[p].neighbors,_[p].x+=v.x,_[p].y+=v.y,_[p].width+=v.width,_[p].height+=v.height,_[p].confidence=Math.max(_[p].confidence,v.confidence)}var b=[];for(r=0;r<d;++r)i=_[r].neighbors,i>=a&&b.push({x:(2*_[r].x+i)/(2*i),y:(2*_[r].y+i)/(2*i),width:(2*_[r].width+i)/(2*i),height:(2*_[r].height+i)/(2*i),neighbors:_[r].neighbors,confidence:_[r].confidence});var g=[];for(i=b.length,r=0;r<i;++r){var v=b[r],w=!0;for(f=0;f<i;++f){var y=b[f],m=.25*y.width+.5|0;if(r!=f&&v.x>=y.x-m&&v.y>=y.y-m&&v.x+v.width<=y.x+y.width+m&&v.y+v.height<=y.y+y.height+m&&(y.neighbors>Math.max(3,v.neighbors)||v.neighbors<3)){w=!1;break}}w&&g.push(v)}return g}}}();t.bbf=e}(jsfeat);