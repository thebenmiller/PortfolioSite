"use strict";var svmFilter=function(){function r(){function r(r,f,a){for(var t,o,n,s,u,h,c,l,d,y=i>>2,A=0;A<i;A++)s=v[A],A<s&&(u=r[A],r[A]=r[s],r[s]=u,u=f[A],f[A]=f[s],f[s]=u);for(var w=1;w<i;w<<=1){o=0,t=i/(w<<1);for(var F=0;F<w;F++){h=e[o+y],c=a*e[o];for(var p=F;p<i;p+=w<<1)n=p+w,l=h*r[n]+c*f[n],d=h*f[n]-c*r[n],r[n]=r[p]-l,r[p]+=l,f[n]=f[p]-d,f[p]+=d;o+=t}}}function f(){v="undefined"!=typeof Uint8Array?new Uint8Array(i):new Array(i),"undefined"!=typeof Float64Array?(e=new Float64Array(1.25*i),o=new Float64Array(i),n=new Float64Array(i)):(e=new Array(1.25*i),o=new Array(i),n=new Array(i))}function a(){var r=0,f=0,a=0;for(v[0]=0;++r<i;){for(a=i>>1;a<=f;)f-=a,a>>=1;f+=a,v[r]=f}}function t(){var r=i>>1,f=i>>2,a=i>>3,t=r+f,o=Math.sin(Math.PI/i),n=2*o*o,v=Math.sqrt(n*(2-n)),s=e[f]=1,u=e[0]=0;o=2*n;for(var h=1;h<a;h++)s-=n,n+=o*s,u+=v,v-=o*u,e[h]=u,e[f-h]=s;0!==a&&(e[a]=Math.sqrt(.5));for(var c=0;c<f;c++)e[r-c]=e[c];for(var l=0;l<t;l++)e[l+r]=-e[l]}var o,n,i=0,v=null,e=null;this.init=function(r){if(0===r||0!==(r&r-1))throw new Error("init: radix-2 required");i=r,f(),a(),t()},this.fft1d=function(f,a){r(f,a,1)},this.ifft1d=function(f,a){var t=1/i;r(f,a,-1);for(var o=0;o<i;o++)f[o]*=t,a[o]*=t},this.fft2d=function(r,f){for(var a=0,t=0;t<i;t++){a=t*i;for(var v=0;v<i;v++)o[v]=r[v+a],n[v]=f[v+a];this.fft1d(o,n);for(var e=0;e<i;e++)r[e+a]=o[e],f[e+a]=n[e]}for(var s=0;s<i;s++){for(var u=0;u<i;u++)a=s+u*i,o[u]=r[a],n[u]=f[a];this.fft1d(o,n);for(var h=0;h<i;h++)a=s+h*i,r[a]=o[h],f[a]=n[h]}},this.ifft2d=function(r,f){for(var a=0,t=0;t<i;t++){a=t*i;for(var v=0;v<i;v++)o[v]=r[v+a],n[v]=f[v+a];this.ifft1d(o,n);for(var e=0;e<i;e++)r[e+a]=o[e],f[e+a]=n[e]}for(var s=0;s<i;s++){for(var u=0;u<i;u++)a=s+u*i,o[u]=r[a],n[u]=f[a];this.ifft1d(o,n);for(var h=0;h<i;h++)a=s+h*i,r[a]=o[h],f[a]=n[h]}},this.real_ifft2d=function(r,f){for(var a,t=0,v=0;v<i;v++){t=v*i;for(var e=0;e<i;e++)o[e]=r[e+t],n[e]=f[e+t];this.ifft1d(o,n);for(var s=0;s<i;s++)r[s+t]=o[s],f[s+t]=n[s]}for(var u=i/2,h=0,c=0;c<i;c+=2){t=c,a=c+1,o[0]=r[0+t],n[0]=r[0+a],o[i/2]=r[u*i+t],n[i/2]=r[u*i+a];for(var s=1;s<u;s++)h=s*i,o[s]=r[h+t]-f[h+a],o[i-s]=r[h+t]+f[h+a],n[s]=f[h+t]+r[h+a],n[i-s]=r[h+a]-f[h+t];this.ifft1d(o,n);for(var l=0;l<i;l++)t=c+l*i,a=c+1+l*i,r[t]=o[l],r[a]=n[l]}},this.real_fft2d=function(r,f){for(var a=0,t=0,v=0;v<i;v+=2){a=v*i,t=(v+1)*i;for(var e=0;e<i;e++)o[e]=r[e+a],n[e]=r[e+t];this.fft1d(o,n),r[0+a]=o[0],r[0+t]=n[0],f[0+a]=0,f[0+t]=0,r[i/2+a]=o[i/2],r[i/2+t]=n[i/2],f[i/2+a]=0,f[i/2+t]=0;for(var s=1;s<i/2;s++)r[s+a]=.5*(o[s]+o[i-s]),f[s+a]=.5*(n[s]-n[i-s]),r[s+t]=.5*(n[s]+n[i-s]),f[s+t]=-.5*(o[s]-o[i-s]),r[i-s+a]=r[s+a],f[i-s+a]=-f[s+a],r[i-s+t]=r[s+t],f[i-s+t]=-f[s+t]}for(var u=0;u<i;u++){for(var h=0;h<i;h++)a=u+h*i,o[h]=r[a],n[h]=f[a];this.fft1d(o,n);for(var c=0;c<i;c++)a=u+c*i,r[a]=o[c],f[a]=n[c]}}}var f,a,t,o,n,i,v,e,s,u,h;this.fft_inplace=function(r,a){"undefined"==typeof a&&(a=u);for(var t=0;t<i;t++)a[t]=0;return f.real_fft2d(r,a),[r,a]},this.ifft=function(r,a){return f.real_ifft2d(r,a),r};var c=function(r,f){for(var a,t,o=0;o<i;o++)a=r[0][o]*f[0][o]-r[1][o]*f[1][o],t=r[0][o]*f[1][o]+r[1][o]*f[0][o],r[0][o]=a,r[1][o]=t};this.init=function(c,l,d,A,w){n=y(A-1+w),i=n*n,f=new r,f.init(n),a=Array(d);for(var F,p=(A-1)/2,_=0;_<d;_++){for(var g,M,m=new Float64Array(i),q=new Float64Array(i),x=0;x<A;x++)for(var U=0;U<A;U++)g=U<p?n-p:-p,M=x<p?n-p:-p,m[U+g+(x+M)*n]=c[_][A-1-x+(A-1-U)*A];F=this.fft_inplace(m,q),a[_]=F}o=new Float64Array(d);for(var _=0;_<d;_++)o[_]=l[_];t=Array(d),u=Array(d);for(var _=0;_<d;_++)t[_]=new Float64Array(w*w),u[_]=new Float64Array(w*w);h=new Float64Array(i),s=d,v=A,e=w},this.getResponses=function(r){for(var f,i,u=v-1+e,y=0;y<s;y++){for(var w=0;w<n*n;w++)h[w]=0;r[y]=l(r[y]);for(var w=0;w<u;w++)for(var F=0;F<u;F++)h[w+n*F]=r[y][F+u*w];f=this.fft_inplace(h),c(f,a[y]),f=this.ifft(f[0],f[1]),i=(v-1)/2;for(var w=0;w<e;w++)for(var F=0;F<e;F++)t[y][w+F*e]=f[i+F+(w+i)*n];for(var w=0;w<e*e;w++)t[y][w]+=o[y];t[y]=d(t[y]),A(t[y])}return t};var l=function(r){for(var f,a=v-1+e,t=0,o=1e3,n=0;n<a;n++)for(var i=0;i<a;i++)f=r[i+a*n],f<o&&(o=f),f>t&&(t=f);for(var s=t-o,n=0;n<a;n++)for(var i=0;i<a;i++)r[i+a*n]=(r[i+a*n]-o)/s;return r},d=function(r){for(var f=0;f<e;f++)for(var a=0;a<e;a++)r[f+a*e]=1/(1+Math.exp(-(r[f+a*e]-1)));return r},y=function(r){return r--,r|=r>>1,r|=r>>2,r|=r>>4,r|=r>>8,r|=r>>16,r++,r},A=function(r){for(var f=r.length,a=0,t=1,o=0;o<f;o++)a=r[o]>a?r[o]:a,t=r[o]<t?r[o]:t;var n=a-t;if(0==n)console.log("a patchresponse was monotone, causing normalization to fail. Leaving it unchanged.");else for(var o=0;o<f;o++)r[o]=(r[o]-t)/n}};